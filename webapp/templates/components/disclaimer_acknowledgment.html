{% extends 'base.html' %}

{% block title %}Mom&BabyBot - Подтверждение ознакомления с дисклеймером{% endblock %}

{% block content %}
<div class="glass-container mb-6">
    <h1 class="text-2xl font-bold mb-4">Подтверждение ознакомления с дисклеймером</h1>
    <p class="text-dark-gray mb-4">
        Для использования функции "{{ feature_display }}" необходимо подтвердить ознакомление с дисклеймером.
    </p>
</div>

<!-- Disclaimer Component -->
{% include 'components/disclaimer.html' with style='glass' %}

<div class="neo-container mb-6">
    <div class="p-6">
        <h3 class="text-lg font-semibold mb-4">Важная информация</h3>
        <div class="mb-6 text-dark-gray">
            <p class="mb-4">
                Данное приложение предоставляет общую информацию и рекомендации, которые не заменяют 
                профессиональную медицинскую консультацию, диагностику или лечение.
            </p>
            <p class="mb-4">
                <strong>Обязательно проконсультируйтесь с врачом:</strong>
            </p>
            <ul class="list-disc pl-5 mb-4">
                <li>Перед принятием любых решений, касающихся вашего здоровья или здоровья вашего ребенка</li>
                <li>При возникновении любых симптомов или изменений в состоянии здоровья</li>
                <li>Для получения персонализированных рекомендаций и назначений</li>
                <li>В случае экстренных ситуаций немедленно обратитесь за медицинской помощью</li>
            </ul>
            <p class="mb-4">
                Использование данного приложения не создает отношений врач-пациент и не может 
                заменить личную консультацию с квалифицированным медицинским специалистом.
            </p>
        </div>
        
        <div class="flex items-center mb-6">
            <input type="checkbox" id="acknowledgmentCheckbox" class="mr-3 h-4 w-4">
            <label for="acknowledgmentCheckbox" class="text-sm text-dark-gray">
                Я прочитал(а) и понимаю приведенную выше информацию. Я подтверждаю, что буду использовать 
                данное приложение только в качестве дополнительного источника информации и обращусь к 
                врачу для получения профессиональной медицинской помощи.
            </label>
        </div>
        
        <div class="flex space-x-4">
            <button 
                id="confirmButton" 
                class="glass-button glass-primary px-6 py-3 disabled:opacity-50 disabled:cursor-not-allowed"
                disabled
            >
                Подтвердить и продолжить
            </button>
            <a href="/" class="glass-button px-6 py-3">
                Отмена
            </a>
        </div>
    </div>
</div>

<!-- Loading indicator -->
<div id="loadingIndicator" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="glass-container p-6 text-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"></div>
        <p>Сохранение подтверждения...</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('acknowledgmentCheckbox');
    const confirmButton = document.getElementById('confirmButton');
    const loadingIndicator = document.getElementById('loadingIndicator');
    
    // Включаем кнопку только когда чекбокс отмечен
    checkbox.addEventListener('change', function() {
        confirmButton.disabled = !this.checked;
    });
    
    // Обработка подтверждения
    confirmButton.addEventListener('click', function() {
        if (!checkbox.checked) {
            alert('Пожалуйста, подтвердите ознакомление с дисклеймером');
            return;
        }
        
        // Показываем индикатор загрузки
        loadingIndicator.classList.remove('hidden');
        confirmButton.disabled = true;
        
        // Отправляем запрос на подтверждение
        fetch('{% url "webapp:acknowledge_disclaimer" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                'feature': '{{ feature }}'
            })
        })
        .then(response => response.json())
        .then(data => {
            loadingIndicator.classList.add('hidden');
            
            if (data.success) {
                // Перенаправляем на исходную страницу
                window.location.href = '{{ return_url }}';
            } else {
                alert('Ошибка: ' + (data.error || 'Неизвестная ошибка'));
                confirmButton.disabled = false;
            }
        })
        .catch(error => {
            loadingIndicator.classList.add('hidden');
            console.error('Error:', error);
            alert('Произошла ошибка при сохранении подтверждения');
            confirmButton.disabled = false;
        });
    });
    
    // Функция для получения CSRF токена
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>
{% endblock %}